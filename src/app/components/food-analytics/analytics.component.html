<!-- src/app/analytics/analytics.component.html -->
<div class="layout">
  <!-- Sidebar lives outside; you already have it -->
  <app-sidebar></app-sidebar>

  <!-- Main content -->
  <div class="content analytics-page">
    <!-- Header KPI cards -->
    <section class="kpis">
        <div class="kpi kpi-consumed">
            <div class="kpi-title">
            {{ range() === 'day' ? 'Daily Consumed' : 'Monthly Consumed' }}
            </div>
            <div class="kpi-value">{{ consumed() }}</div>
        </div>

        <div class="kpi kpi-donation">
            <div class="kpi-title">
            {{ range() === 'day' ? 'Daily Donation' : 'Monthly Donation' }}
            </div>
            <div class="kpi-value">{{ donation() }}</div>
        </div>

        <div class="kpi kpi-expired">
            <div class="kpi-title">
            {{ range() === 'day' ? 'Daily Expired' : 'Monthly Expired' }}
            </div>
            <div class="kpi-value">{{ expired() }}</div>
        </div>
        </section>


    <!-- Charts row -->
    <section class="charts-row">
      <!-- Pie card -->
      <div class="panel pie-panel">
        <div class="panel-body">
          <!-- Pie chart title -->
          <div class="pie-chart-title">{{ getPieChartTitle() }}</div>
          
          <!-- Color legend -->
          <div class="pie-legend">
            <div class="legend-item" *ngIf="hasConsumedData()">
              <div class="legend-square legend-consumed"></div>
              <span class="legend-label">Consumed</span>
            </div>
            <div class="legend-item" *ngIf="hasDonationData()">
              <div class="legend-square legend-donation"></div>
              <span class="legend-label">Donation</span>
            </div>
            <div class="legend-item" *ngIf="hasExpiredData()">
              <div class="legend-square legend-expired"></div>
              <span class="legend-label">Expired</span>
            </div>
          </div>
          
          <!-- 2-column layout: buttons on left, chart on right -->
          <div class="pie-layout">
            <!-- Column 1: Toggle buttons -->
            <div class="toggle-stack">
              <button
                class="pill"
                [class.active]="range()==='day'"
                (click)="setRange('day')">
                Day
              </button>
              <button
                class="pill"
                [class.disabled]="range()==='day'"
                [class.active]="range()==='month'"
                (click)="setRange('month')">
                Month
              </button>
            </div>

            <!-- Column 2: Pie chart -->
            <div class="chart-wrap" *ngIf="!loading(); else loadingTpl">
              <canvas 
                *ngIf="hasPieData(); else noPieDataTpl"
                baseChart
                [data]="pieData()"
                [options]="pieOptions"
                [type]="'pie'">
              </canvas>
              <ng-template #noPieDataTpl>
                <div class="no-data-message">{{ getPieNoDataMessage() }}</div>
              </ng-template>
            </div>
          </div>
        </div>
      </div>

      <!-- Bar card (top expired) -->
      <div  
        class="panel bar-panel"
        [ngClass]="{
          'expired-mode': selectedStatus() === 'expired',
          'donated-mode': selectedStatus() === 'donated',
          'consumed-mode': selectedStatus() === 'consumed'
        }">
        <div class="status-tags">
          <span 
            class="tag"
            [class.active]="selectedStatus() === 'expired'"
            (click)="onStatusChange('expired')">
            Expired
          </span>

          <span 
            class="tag"
            [class.active]="selectedStatus() === 'donated'"
            (click)="onStatusChange('donated')">
            Donated
          </span>

          <span 
            class="tag"
            [class.active]="selectedStatus() === 'consumed'"
            (click)="onStatusChange('consumed')">
            Consumed
          </span>
        </div>

        <div class="bar-headings">
          <div class="bar-subtitle">{{ getBarTitle() }}</div>
          <div class="bar-topname" *ngIf="getTopFoodName()">
            {{ getTopFoodName() }}
          </div>
        </div>

        <div class="panel-body">
          <div class="chart-wrap" *ngIf="!loading(); else loadingTpl">
            <canvas 
              *ngIf="currentBarData().labels.length > 0; else noBarDataTpl"
              baseChart
              [data]="currentBarData()"
              [options]="barOptions"
              [type]="'bar'">
            </canvas>
            <ng-template #noBarDataTpl>
              <div class="no-data-message">{{ getNoDataMessage() }}</div>
            </ng-template>
          </div>
        </div>
      </div>
    </section>

    <ng-template #loadingTpl>
      <div class="loading">Loadingâ€¦</div>
    </ng-template>
  </div>
</div>
