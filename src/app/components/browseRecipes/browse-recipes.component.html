<div class="page-layout">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>
  
  <!-- Main Content -->
  <div class="main-content">
    <h1 class="page-title">Browse Meals</h1>
    
    <!-- Suggested Meals Section -->
    <div class="recipes-section">
      <h2 class="section-title">Suggested Meals</h2>
      <div class="recipes-carousel">
        <button class="carousel-arrow left" (click)="previousSuggested()">‚Äπ</button>
        <div class="recipes-list-wrapper">
          <div class="recipes-list" [style.transform]="'translateX(calc(50% - 100px - ' + currentSuggestedIndex + ' * 230px))'">
            <div 
              class="recipe-card" 
              *ngFor="let meal of suggestedMeals; let i = index"
              [class.active]="i === currentSuggestedIndex"
              (click)="selectMeal(meal)">
              <div class="recipe-image">
                <img [src]="meal.image" [alt]="meal.name" (error)="onImageError($event)" (load)="onImageLoad($event)">
              </div>
              <div class="recipe-name" (click)="selectMeal(meal); $event.stopPropagation()">{{ meal.name }}</div>
            </div>
          </div>
        </div>
        <button class="carousel-arrow right" (click)="nextSuggested()">‚Ä∫</button>
      </div>
      <div class="info-text">
        <p>***Click a food name to see more details***</p>
        <p>***The provided images may differ from the actual dishes***</p>
      </div>
    </div>

    <!-- Generic Meals Section -->
    <div class="recipes-section">
      <h2 class="section-title">Generic Meals</h2>
      <div class="recipes-carousel">
        <button class="carousel-arrow left" (click)="previousMore()">‚Äπ</button>
        <div class="recipes-list-wrapper">
          <div class="recipes-list" [style.transform]="'translateX(calc(50% - 100px - ' + currentMoreIndex + ' * 230px))'">
            <div 
              class="recipe-card" 
              *ngFor="let meal of genericMeals; let i = index"
              [class.active]="i === currentMoreIndex"
              (click)="selectMeal(meal)">
            <div class="recipe-image">
              <img [src]="meal.image" [alt]="meal.name" (error)="onImageError($event)" (load)="onImageLoad($event)">
            </div>
            <div class="recipe-name" (click)="selectMeal(meal); $event.stopPropagation()">{{ meal.name }}</div>
            </div>
          </div>
        </div>
        <button class="carousel-arrow right" (click)="nextMore()">‚Ä∫</button>
      </div>
      <div class="info-text">
        <p>***Click a food name to see more details***</p>
        <p>***The provided images may differ from the actual dishes***</p>
      </div>
    </div>

    <!-- Marked Foods Section -->
    <div class="inventory-section">
      <div class="inventory-header">
        <h2 class="section-title">Marked Foods</h2>
        <div class="search-filter-bar">
          <input 
            type="text" 
            class="search-input" 
            placeholder="Food item Name"
            [(ngModel)]="searchTerm"
            (input)="filterInventory()">
          <button class="search-btn" (click)="filterInventory()">
            <span class="search-icon">üîç</span>
          </button>
          <button class="filter-btn" (click)="toggleFilter()">
            <span class="filter-icon">‚ò∞</span>
          </button>
        </div>
      </div>

      <div class="inventory-container">
        <div class="table-headers">
          <div class="header-cell">Name</div>
          <div class="header-cell">Quantity</div>
          <div class="header-cell">Category</div>
          <div class="header-cell">Mark</div>
          <div class="header-cell">Marked Quantity</div>
          <div class="header-cell">Expiry</div>
        </div>

        <div class="inventory-list">
          <div 
            class="inventory-item" 
            *ngFor="let item of paginatedInventory; let i = index"
            [class.selected]="selectedItemIndex === i"
            (click)="selectItem(i)">
            <div class="item-name">{{ item.name }}</div>
            <div class="item-quantity">
              <span class="quantity-circle">{{ item.quantity }}</span>
            </div>
            <div class="item-category">
              <span class="category-badge" [class]="'category-' + item.category.toLowerCase()">
                <span class="category-icon">{{ getCategoryIcon(item.category) }}</span>
                {{ item.category }}
              </span>
            </div>
            <div class="item-mark">
              <span *ngIf="item.marked" class="marked-badge">
                <span class="checkmark">‚úì</span>
                Marked
              </span>
            </div>
            <div class="item-marked-quantity">
              <span *ngIf="item.markedQuantity > 0" class="marked-quantity-badge">
                {{ item.markedQuantity }}
              </span>
              <span *ngIf="item.markedQuantity === 0" class="no-marked-quantity">-</span>
            </div>
            <div class="item-expiry">
              <span class="expiry-date">{{ item.expiry }}</span>
            </div>
          </div>
        </div>
        
        <!-- Pagination Controls -->
        <div class="pagination-container" *ngIf="totalPages > 1">
          <div class="pagination-buttons">
            <button 
              *ngFor="let page of getPagesArray()" 
              class="page-button"
              [class.active]="currentPage === page"
              (click)="goToPage(page)">
              {{ page }}
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Filter Drawer -->
    <div class="filter-drawer" [class.open]="showFilter">
      <div class="filter-header">
        <h2>Filters</h2>
        <button class="close-btn" (click)="toggleFilter()">√ó</button>
      </div>

      <!-- Category Filter -->
      <div class="filter-section">
        <h3>Category</h3>
        
        <!-- All -->
        <label>
          <input
            type="checkbox"
            name="cat_all"
            [checked]="selectedCategories.size === availableCategories.length"
            (change)="onCategoryAllToggle($any($event.target).checked)" />
          All
        </label>

        <!-- Individual Categories -->
        <label *ngFor="let cat of availableCategories">
          <input
            type="checkbox"
            name="cat_{{cat}}"
            [checked]="selectedCategories.has(cat)"
            (change)="onCategoryToggle(cat, $any($event.target).checked)" />
          {{ cat }}
        </label>
      </div>

      <!-- Expiry Filter -->
      <div class="filter-section">
        <h3>Expired in</h3>

        <div class="expired-input-group">
          <input
            type="number"
            [(ngModel)]="expiryFilterDays"
            placeholder="Enter days"
            min="0" />
          <span>day(s)</span>
        </div>

        <button class="apply-btn" (click)="applyExpiryFilter()">Apply</button>
        <button class="reset-btn" (click)="resetExpiryFilter()">Reset</button>
      </div>

      <!-- Reset All Filters -->
      <div class="filter-section">
        <button class="reset-all-btn" (click)="resetFilters()">Reset All Filters</button>
      </div>
    </div>


    <!-- Back Button -->
    <div class="back-button-container">
      <button class="btn-back" (click)="back()">Back</button>
    </div>
  </div>
</div>

