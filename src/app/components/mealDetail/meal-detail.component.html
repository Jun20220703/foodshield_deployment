<div class="page-layout">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>
  
  <!-- Main Content -->
  <div class="main-content">
    <div class="meal-detail-container">
      <!-- Recipe Detail -->
      <div class="recipe-detail-card" *ngIf="recipe">
        <div class="recipe-header">
          <h1 class="recipe-title">{{ recipe.name }}</h1>
        </div>

        <div class="recipe-content">
          <div class="recipe-left-column">
            <div class="recipe-image-container">
              <img 
                [src]="recipe.image" 
                [alt]="recipe.name" 
                title="Recipe image"
                class="recipe-image"
                (error)="onImageError($event)"
                (load)="onImageLoad($event)">
            </div>

            <!-- Kcal -->
            <div class="recipe-kcal" *ngIf="recipe.kcal">
              <h2>Kcal</h2>
              <p>{{ recipe.kcal }}</p>
            </div>
          </div>

          <div class="recipe-info">
            <div class="recipe-description" *ngIf="recipe.description">
              <h2>Description</h2>
              <p>{{ recipe.description }}</p>
            </div>

            <!-- Ingredients -->
            <div class="recipe-ingredients" *ngIf="recipe.ingredients">
              <h2>Ingredients</h2>
              <div class="ingredients-list" *ngIf="ingredientsList.length > 0">
                <div class="ingredient-item" *ngFor="let ingredient of ingredientsList; trackBy: trackByIngredientName" 
                     [class.expiring-soon]="ingredient.daysUntilExpiry !== undefined && ingredient.daysUntilExpiry <= 7"
                     [class.has-marked]="ingredient.markedQuantity > 0"
                     [class.has-non-marked]="ingredient.markedQuantity === 0 && ingredient.nonMarkedQuantity > 0"
                     [class.no-marked]="ingredient.markedQuantity === 0 && (ingredient.nonMarkedQuantity === 0 || !ingredient.nonMarkedQuantity)">
                  <span class="ingredient-name">{{ ingredient.name }}</span>
                  <span class="ingredient-quantity">× {{ ingredient.quantity }}</span>
                  <span class="ingredient-marked" 
                        [class.has-marked]="ingredient.markedQuantity > 0"
                        [class.has-non-marked]="ingredient.markedQuantity === 0 && ingredient.nonMarkedQuantity > 0"
                        [class.no-marked]="ingredient.markedQuantity === 0 && (ingredient.nonMarkedQuantity === 0 || !ingredient.nonMarkedQuantity)"
                        [class.expiring-soon]="ingredient.daysUntilExpiry !== undefined && ingredient.daysUntilExpiry <= 7">
                    <span *ngIf="ingredient.markedQuantity > 0">
                      (Marked: {{ ingredient.markedQuantity }})
                    </span>
                    <span *ngIf="ingredient.markedQuantity === 0 && ingredient.nonMarkedQuantity > 0">
                      (Non-Marked: {{ ingredient.nonMarkedQuantity }})
                    </span>
                    <span *ngIf="ingredient.markedQuantity === 0 && (ingredient.nonMarkedQuantity === 0 || !ingredient.nonMarkedQuantity)">
                      (Not in Marked/Non-Marked Foods)
                    </span>
                  </span>
                  <span *ngIf="ingredient.daysUntilExpiry !== undefined && ingredient.daysUntilExpiry <= 7" 
                        class="expiry-warning">
                    ⚠️ {{ getExpiryMessage(ingredient.daysUntilExpiry) }} 
                    ({{ ingredient.expiryLocation === 'marked' ? 'Marked' : ingredient.expiryLocation === 'non-marked' ? 'Non-Marked' : 'Both' }})
                  </span>
                </div>
              </div>
              <p *ngIf="ingredientsList.length === 0">{{ recipe.ingredients }}</p>
            </div>

            <!-- Additional recipe details can be added here -->
            <div class="recipe-details">
              <h2>Recipe Details</h2>
              <p>More detailed information about this recipe will be displayed here.</p>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn-back" (click)="back()">← Back</button>
          <button class="btn-plan-meal" (click)="planMeal()">Plan Meal</button>
        </div>
      </div>

      <!-- Recipe Not Found -->
      <div class="recipe-not-found" *ngIf="!recipe">
        <h2>Recipe Not Found</h2>
        <p>The recipe you're looking for doesn't exist.</p>
        <button class="btn-back" (click)="back()">← Back to Recipes</button>
      </div>
    </div>
  </div>
</div>

<!-- Plan Meal Modal -->
<div class="modal-overlay" *ngIf="showPlanModal" (click)="closePlanModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Plan Meal</h2>
    <div class="modal-form">
      <div class="form-group">
        <label for="mealDate">Date:</label>
        <input type="date" id="mealDate" [(ngModel)]="selectedDate" required>
      </div>
      <div class="form-group">
        <label for="mealType">Meal Type:</label>
        <select id="mealType" [(ngModel)]="selectedMealType" required>
          <option value="Breakfast">Breakfast</option>
          <option value="Lunch">Lunch</option>
          <option value="Dinner">Dinner</option>
          <option value="Snack">Snack</option>
        </select>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="closePlanModal()" [disabled]="isPlanning">Cancel</button>
      <button class="btn-confirm" (click)="confirmPlanMeal()" [disabled]="isPlanning">
        {{ isPlanning ? 'Planning...' : 'Confirm' }}
      </button>
    </div>
  </div>
</div>

